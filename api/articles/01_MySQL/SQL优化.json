{"title":"MySQL优化经验总结","uid":"4337dc43129fb733f89eff2c212fe09e","slug":"01_MySQL/SQL优化","date":"2022-05-20T15:15:47.000Z","updated":"2022-10-06T07:41:21.366Z","comments":true,"path":"api/articles/01_MySQL/SQL优化.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/mikeah2011/oss@main/uPic/6411.png","content":"<p><img src=\"https://cdn.jsdelivr.net/gh/mikeah2011/oss@main/uPic/6411.png\" alt=\"图片\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>线上SQL的调优经验</p></blockquote>\n<ul>\n<li><code>slow_query_log</code> 日志中收集到的慢 SQL ，结合 <code>explain</code> 分析是否命中索引。</li>\n<li>减少索引扫描行数，有针对性的优化慢 SQL。</li>\n<li>建立联合索引，由于联合索引的每个叶子节点包含检索字段的信息，按最左前缀原则匹配后，再按其它条件过滤，减少回表的数据量。</li>\n<li>还可以使用虚拟列和联合索引来提升复杂查询的执行效率。</li>\n<li>监控sql执行情况，发邮件、短信报警，便于快速识别慢查询sql</li>\n<li>打开数据库慢查询日志功能</li>\n<li>简化业务逻辑</li>\n<li>代码重构、优化</li>\n<li>异步处理</li>\n<li>sql优化</li>\n<li>索引优化</li>\n</ul>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>SQL优化</p></blockquote>\n<ol>\n<li><p>分页优化。比如电梯直达，<code>limit 100000,10</code> 先查找起始的主键id，再通过<code>id&gt;#&#123;value&#125;</code>往后取10条</p>\n</li>\n<li><p>尽量使用<code>覆盖索引</code>，索引的叶节点中已经包含要查询的字段，减少<code>回表查询</code></p>\n</li>\n<li><p>SQL优化（索引优化、小表驱动大表、虚拟列、适当增加冗余字段减少连表查询、联合索引、排序优化、慢日志 Explain 分析执行计划）。</p>\n<ol>\n<li><p><code>where</code>子句</p>\n<p>​\t避免对字段进行<code>null</code>值判断、表达式操作等；</p>\n<p>​\t<code>where</code>表之间的连接，必须写在其他<code>where</code>条件之前；</p>\n<p>​\t可过滤掉最大数量记录的条件必须写在 <code>where</code> 子句的末尾，<code>having</code>最后；</p>\n</li>\n<li><p>优先考虑在<code>where</code>及<code>order by</code>涉及的列上建立索引；</p>\n</li>\n<li><p>避免在索引列上使用函数运算、<code>is null</code>和<code>is not null</code>；</p>\n</li>\n<li><p>避免使用<code>select *</code>;</p>\n</li>\n<li><p>使用 </p>\n<p><code>union all</code> 代替 <code>union</code></p>\n<p><code>exists</code>代替<code>in</code></p>\n<p><code>not exists</code> 代替<code> not in</code></p>\n<p>连接查询代替子查询；</p>\n</li>\n<li><p>批量操作</p>\n</li>\n<li><p>小表驱动大表；</p>\n</li>\n<li><p>多用limit</p>\n</li>\n<li><p>in中值太多  分页</p>\n</li>\n<li><p>增量查询</p>\n</li>\n<li><p>高效的分页</p>\n</li>\n<li><p>join表不宜过多</p>\n</li>\n<li><p>控制索引数量</p>\n</li>\n<li><p>选择合理的字段类型</p>\n</li>\n<li><p>提升group by 的效率</p>\n</li>\n<li><p>索引优化</p>\n</li>\n</ol>\n</li>\n<li><p>设计优化（避免使用NULL、用简单数据类型如int、减少 text 类型、分库分表）。</p>\n</li>\n<li><p>硬件优化（使用SSD 减少 I&#x2F;O 时间、足够大的网络带宽、尽量大的内存）</p>\n</li>\n</ol>\n","feature":true,"text":" 线上SQL的调优经验 slow_query_log 日志中收集到的慢 SQL ，结合 explain 分析是否命中索引。 减少索引扫描行数，有针对性的优化慢 SQL。 建立联合索引，由于联合索引的每个叶子节点包含检索字段的信息，按最左前缀原则匹配后，再按其它条件过滤，减少回表的...","link":"","photos":[],"count_time":{"symbolsCount":902,"symbolsTime":"1 mins."},"categories":[{"name":"SQL","slug":"SQL","count":15,"path":"api/categories/SQL.json"}],"tags":[{"name":"MySQL","slug":"MySQL","count":16,"path":"api/tags/MySQL.json"}],"toc":"","author":{"name":"Michael","slug":"michael","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"Just Do IT","socials":{"github":"https://github.com/mikeah2011","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/7318914058","zhihu":"https://www.zhihu.com/people/tridiamond","csdn":"https://blog.csdn.net/TriDiamond6","juejin":"https://juejin.cn/user/1873223546578589","customs":{"bilibili":{"icon":"http://localhost:4000/svg/bilibili.svg","link":"https://live.bilibili.com/22619211"},"baidu":{"icon":"iconfont icon-baidu","link":"https://live.bilibili.com/22619211"},"book":{"icon":"far fa-address-book","link":"https://live.bilibili.com/22619211"},"facebook":{"icon":"/svg/facebook.svg","link":"https://facebook.com"}}}},"mapped":true,"prev_post":{},"next_post":{"title":"Redis Cluster 原理探讨","uid":"ca18af8a7c9f51eca47fbf29c78c60fe","slug":"02_Redis/RedisCluster","date":"2020-07-25T12:55:57.000Z","updated":"2022-10-06T07:47:29.146Z","comments":true,"path":"api/articles/02_Redis/RedisCluster.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/mikeah2011/oss@main/uPic/image-20221004222258747.png","text":" Redis Cluster hash(key) % 16384 &#x3D; slot 哈希槽 &#x3D; hash(key) &amp; 2^n^ slot - hash槽分布范围[0-5460] 、 [5461-10922]、[10923-16383] # 创建Redis...","link":"","photos":[],"count_time":{"symbolsCount":"4.8k","symbolsTime":"4 mins."},"categories":[{"name":"Redis","slug":"Redis","count":10,"path":"api/categories/Redis.json"}],"tags":[{"name":"redis","slug":"redis","count":10,"path":"api/tags/redis.json"},{"name":"高可用","slug":"高可用","count":1,"path":"api/tags/高可用.json"},{"name":"集群","slug":"集群","count":1,"path":"api/tags/集群.json"}],"author":{"name":"Michael","slug":"michael","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"Just Do IT","socials":{"github":"https://github.com/mikeah2011","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/7318914058","zhihu":"https://www.zhihu.com/people/tridiamond","csdn":"https://blog.csdn.net/TriDiamond6","juejin":"https://juejin.cn/user/1873223546578589","customs":{"bilibili":{"icon":"http://localhost:4000/svg/bilibili.svg","link":"https://live.bilibili.com/22619211"},"baidu":{"icon":"iconfont icon-baidu","link":"https://live.bilibili.com/22619211"},"book":{"icon":"far fa-address-book","link":"https://live.bilibili.com/22619211"},"facebook":{"icon":"/svg/facebook.svg","link":"https://facebook.com"}}}},"feature":true}}